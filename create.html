<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Cr√©ation ‚Äì M√©mento IA RCH</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="style.css">

  <!-- Libs compression + QR -->
  <script src="https://unpkg.com/pako@2.1.0/dist/pako.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
</head>

<body>

  <nav class="tabs">
    <a href="index.html" class="tab">üè† Accueil</a>
    <a href="scan.html" class="tab">üì∑ Lecture QR</a>
    <a class="tab active">üìù Cr√©ation</a>
  </nav>

  <main>
    <h1 class="page-title">Cr√©er une fiche IA</h1>

    <!-- Bouton reset en haut -->
    <div style="text-align:center;margin-bottom:15px;">
      <button id="btnResetCreate" class="btn-reset" style="display:none;">
        üîÑ Cr√©er une nouvelle fiche
      </button>
    </div>

    <!-- ‚ö†Ô∏è AVERTISSEMENT IA -->
    <div style="background:#fff3cd;border-left:4px solid #ff9f1c;padding:10px 12px;margin-bottom:15px;border-radius:8px;color:#856404;font-size:13px;">
      <strong style="display:block;margin-bottom:4px;color:#001F8F;font-size:14px;">‚ö†Ô∏è Avertissement</strong>
      L'IA peut faire des erreurs. Veuillez v√©rifier les r√©ponses et exercer votre jugement professionnel avant toute action op√©rationnelle.
    </div>

    <!-- SECTION M√âTADONN√âES -->
    <section id="sectionMeta" class="card">
      <h2 style="margin-bottom:15px;color:#001F8F;">M√©tadonn√©es de la fiche</h2>
      
      <div class="form-group">
        <label>Titre de la fiche *</label>
        <input type="text" id="meta_title" placeholder="Ex : Identification produit chimique" required>
      </div>

      <div class="form-group">
        <label>Cat√©gorie *</label>
        <select id="meta_category" required>
          <option value="">-- S√©lectionner --</option>
          <option value="Analyse de situation">Analyse de situation</option>
          <option value="Conduite des op√©rations">Conduite des op√©rations</option>
          <option value="Appui op√©rationnel">Appui op√©rationnel</option>
        </select>
      </div>

      <div class="form-group">
        <label>Contexte op√©rationnel *</label>
        <textarea id="meta_context" rows="3" placeholder="D√©crivez le contexte d'utilisation de cette fiche..." required></textarea>
      </div>

      <div class="form-group">
        <label>Version</label>
        <input type="text" id="meta_version" placeholder="1.0">
      </div>

      <div class="form-group">
        <label>Date de cr√©ation</label>
        <input type="date" id="meta_date">
      </div>

      <div class="form-group">
        <label>Auteur</label>
        <input type="text" id="meta_author" placeholder="Nom de l'auteur">
      </div>

      <!-- IA Recommand√©es -->
      <div style="margin-top:20px;padding:15px;background:#f8f9fa;border-radius:8px;border:1px solid #dee2e6;">
        <h3 style="margin:0 0 10px 0;font-size:16px;color:#001F8F;">IA recommand√©es pour cette fiche</h3>
        <p style="font-size:13px;color:#666;margin-bottom:15px;">
          Indiquez le niveau de pertinence de chaque IA (1=Non recommand√©e, 2=Acceptable, 3=Recommand√©e)
        </p>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px;">
          <div>
            <label style="display:block;margin-bottom:5px;font-weight:600;">ChatGPT</label>
            <select id="ai_chatgpt" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;">
              <option value="3">3 - Recommand√©e</option>
              <option value="2">2 - Acceptable</option>
              <option value="1">1 - Non recommand√©e</option>
            </select>
          </div>
          
          <div>
            <label style="display:block;margin-bottom:5px;font-weight:600;">Perplexity</label>
            <select id="ai_perplexity" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;">
              <option value="3">3 - Recommand√©e</option>
              <option value="2">2 - Acceptable</option>
              <option value="1">1 - Non recommand√©e</option>
            </select>
          </div>
          
          <div>
            <label style="display:block;margin-bottom:5px;font-weight:600;">Mistral</label>
            <select id="ai_mistral" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;">
              <option value="3">3 - Recommand√©e</option>
              <option value="2">2 - Acceptable</option>
              <option value="1">1 - Non recommand√©e</option>
            </select>
          </div>
        </div>
      </div>
    </section>

    <!-- SECTION PROMPT DE BASE -->
    <section id="sectionPrompt" class="card">
      <h2 style="margin-bottom:15px;color:#001F8F;">Prompt de base</h2>
      
      <div style="background:#e7f3ff;border-left:4px solid #0066cc;padding:10px 12px;margin-bottom:15px;border-radius:8px;font-size:13px;">
        <strong style="display:block;margin-bottom:4px;color:#0066cc;">üí° Astuce</strong>
        Utilisez <code>{{nom_variable}}</code> pour ins√©rer une variable dans votre prompt.
      </div>

      <textarea 
        id="base_prompt" 
        rows="8" 
        placeholder="R√©digez le prompt de base que l'IA devra suivre. Utilisez {{variable}} pour les √©l√©ments dynamiques.&#10;&#10;Exemple :&#10;Tu es un assistant sp√©cialis√© en risques chimiques. Analyse le produit {{produit}} et indique les dangers principaux."
        style="width:100%;padding:12px;border:1px solid #ccc;border-radius:8px;font-family:'Courier New',monospace;font-size:13px;"></textarea>
    </section>

    <!-- SECTION VARIABLES -->
    <section id="sectionVariables" class="card">
      <h2 style="margin-bottom:15px;color:#001F8F;">Variables dynamiques</h2>
      
      <div style="background:#fff3e6;border-left:4px solid #ff9f1c;padding:10px 12px;margin-bottom:15px;border-radius:8px;font-size:13px;">
        <strong style="display:block;margin-bottom:4px;color:#ff9f1c;">üìå Information</strong>
        Les variables permettent de personnaliser le prompt lors de l'utilisation de la fiche.
      </div>

      <div id="variablesList"></div>

      <button id="btnAddVariable" class="btn btn-secondary" style="margin-top:10px;">
        ‚ûï Ajouter une variable
      </button>
    </section>

    <!-- SECTION G√âN√âRATION -->
    <section id="sectionGenerate" class="card">
      <h2 style="margin-bottom:15px;color:#001F8F;">G√©n√©ration du QR Code</h2>

      <button id="btnGenerate" class="btn" style="font-size:16px;">
        ‚ö° G√©n√©rer JSON + QR Code + URL
      </button>

      <!-- Zone de r√©sultat -->
      <div id="resultZone" style="display:none;margin-top:20px;">
        
        <!-- JSON -->
        <div style="margin-bottom:20px;">
          <h3 style="margin-bottom:10px;color:#001F8F;font-size:16px;">JSON g√©n√©r√©</h3>
          <div style="background:#f8f9fa;padding:12px;border-radius:8px;border:1px solid #dee2e6;">
            <pre id="jsonOutput" style="white-space:pre-wrap;margin:0;font-size:12px;max-height:200px;overflow:auto;"></pre>
          </div>
          <button id="btnCopyJson" class="btn btn-secondary" style="margin-top:10px;">
            üìã Copier le JSON
          </button>
        </div>

        <!-- QR Code -->
        <div style="margin-bottom:20px;">
          <h3 style="margin-bottom:10px;color:#001F8F;font-size:16px;">QR Code</h3>
          <div id="qrContainer" style="text-align:center;padding:20px;background:white;border:2px solid #001F8F;border-radius:8px;margin-bottom:10px;"></div>
          <button id="btnDownloadQR" class="btn" style="display:none;">
            üíæ T√©l√©charger le QR Code
          </button>
        </div>

        <!-- URL Cliquable -->
        <div>
          <h3 style="margin-bottom:10px;color:#001F8F;font-size:16px;">Lien cliquable (pour PDF)</h3>
          <div style="background:#f8f9fa;padding:12px;border-radius:8px;border:1px solid #dee2e6;margin-bottom:10px;">
            <input 
              type="text" 
              id="urlOutput" 
              readonly 
              style="width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;font-size:12px;font-family:monospace;background:white;">
          </div>
          <button id="btnCopyUrl" class="btn btn-secondary">
            üîó Copier le lien
          </button>
        </div>

      </div>
    </section>

  </main>

  <footer>
    ¬© ENSOSP ‚Äì Cne E. Fischer ‚Äì Cdt A. Tirelle ‚Äì V0.11
  </footer>

  <script type="module" src="./src/ui/createFiche.js"></script>

</body>
</html>
